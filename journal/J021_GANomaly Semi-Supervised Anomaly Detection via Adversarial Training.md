# GANomaly: Semi-Supervised Anomaly Detection via Adversarial Training
## Abstract
Anomaly detection은 컴퓨터 비전의 고전적인 문제이다. 비정상 샘플이 적어 정상샘플에 크게 치우쳤을 때 비정상에서 정상을 결정하는 것이다.  
지도학습보다 어려운 것은 문제를 한 클래스 semi-supervised 학습 패러다임의 공간으로 데려가는 알려지지 않은/보이지 않는 이상 사례를 감지하는 것이다.  
**1) 고차원 이미지 공간 생성**과 **2)latent space 추론**을 공동으로 학습하는 cGAN을 사용하여 새로운 이상 탐지 모델을 소개한다.  
G에서 enc-dec-enc sub 네트워크를 사용하면 이미지를 낮은 차원 벡터에 매핑하며, 이 벡터는 생성된 출력 이미지를 재구성하는 데 사용된다.  
추가 encoder 네트워크를 사용하면 생성이미지를 latent 표현에 매핑한다. 훈련 중 이러한 이미지와 latent 벡터 사이의 거리를 최소화하면  
정규 샘플에 대한 데이터 분포를 학습하는 데 도움이 된다.  
결과적으로 inference 시 이 학습된 데이터 분포에서 더 큰 거리 메트릭은 해당 분포의 이상값(이상)을 나타낸다.  
다양한 도메인의 여러 벤치마크 데이터 세트에 대한 실험은 과거 SOTA대비 모델 효능과 우수성을 보여준다.    

## 1. Introduction
지도학습방식은 대규모 데이터에 의존 하지만 실제에서는 관심 클래스의 샘플은 항상 적어 효과적으로 모델링할 수 없다.  
대신, 비정상 탐지의 임무는 정상으로 간주되는 샘플에 대해서만 교육한 다음 학습된 정규성 샘플 분포와 다른 비정상적이고 불충분하게 사용 가능한  
비정상 샘플을 식별하여 이러한 사례를 식별할 수 있도록 하는 것이다.  
예를 들어, 여기에서 우리의 평가에서 고려하는 유형의 응용 프로그램은 항공 또는 국경 보안을 위한 X선 검사이다.  
보안 위협을 제기하는 변칙적 항목이 일반적으로 발생하지 않는 곳에서 그러한 모범적인 데이터는 어느 곳에서나 얻기 어려울 수 있다.  
잠재적인 위협을 제기하는 모든 변칙의 특성은 다양한 외부 요인으로 인해 진화할 수 있다.  
그러나 이러한 어려운 상황에서 인간 보안 운영자는 새롭고 새로운 변칙 위협 서명에 대해 여전히 유능하고 적응 가능한 변칙 감지기이다.  
그림 1에서 볼 수 있듯이 이상 탐지 작업의 공식적인 문제 정의는 다음과 같다.  
![image](https://user-images.githubusercontent.com/40943064/130700993-bfa10430-76a6-45b6-9299-32d909609a43.png)
학습을 위한 많은 수의 정상 샘플 X를 포함하는 데이터 세트 D와 테스트를 위한 상대적으로 적은 비정상 예 Xˆ가 주어지면 모델 f는 θ에 대해 최적화된다.  
f는 학습 중 정상 샘플의 데이터 분포 p**X**를 학습하고 테스트 중 비정상 샘플을 이상치로 식별하는 이상 점수 **A(x: given test sample)** 를 출력한다.  
더 큰 A(x)는 f가 훈련 중에 출력 점수를 최소화하도록 학습하기 때문에 테스트 이미지 내에서 가능한 비정상을 나타낸다.  
A(x)는 **pX** 를 따르지 않음으로써 보지못한 이상을 감지할 수 있다는 점에서 일반적이다.  

**GAN 이상탐지 선행 연구 사례**
1) **AnoGAN** : GAN의 latent 벡터가 데이터의 실제 분포를 나타낸다고 가정하고 latent 벡터를 기반으로 pretrained GAN을 최적화하여 latent 벡터에 다시 매핑한다.  
(잠재 벡터 공간에 다시 매핑하는 엄청난 계산 복잡성이 존재)  
2) **EGBAD** : 이미지 공간에서 잠재 공간으로 공동으로 매핑하는 BiGAN을 학습하고 단순한 MNIST 벤치마크 데이터 세트에도 불구하고 통계 및 계산적으로 우수한 결과를 보고한다.  

본 논문은 GAN을 포함하는 일반적인 이상 탐지 아키텍처를 제안한다.  
AnoGAN과 유사한 맥락에서 단일 컬러 이미지를 입력으로 사용하며, 이는 정상 학습 예제 세트에서만 가져온 것이다.  
그러나 이와 대조적으로 우리의 접근 방식은 2단계 학습이 필요하지 않으며 모델 학습과 이후 추론에 모두 효율적이다.  
EGBAD와 마찬가지로 이미지와 잠재 벡터 공간을 함께 학습한다.  
주 novelty는 enc-dec-enc 파이프라인 내에서 적대적 autoencoder를 사용하여 이미지와 latent vector 공간 내에서 학습 데이터 분포를 포착한다는 사실에서 비롯된다.  
이와 같은 적대적 훈련 아키텍처는 실제로 정상적인 훈련 데이터 예제에만 기반을 두고 있어 까다로운 벤치마크 문제보다 우수한 성능을 제공한다.  
이 논문의 주요 기여는 다음과 같다.  
1) semi-supervised anomaly detection : enc-dec-enc 파이프라인 내의 새로운 adversarial auto encoder로, 이미지와 latent vector space 모두에서 훈련 데이터 분포를 포착하여 최신 GAN 기반 및 기존 autoencoder 기반 접근 방식보다 우수한 결과를 제공한다.
2) Efficacy : 통계적으로나 계산적으로 더 나은 성능을 제공하는 이상 감지에 대한 효율적이고 새로운 접근 방식이다.  
3) Reproducibility : 공개적으로 사용 가능한 코드를 통해 결과를 재현할 수 있는 간단하고 효과적인 알고리즘.  

## 2. Related Works
이상 탐지는 생물의학, 금융 및 비디오 감시, 네트워크 시스템 및 사기 탐지등을 포함하는 영역에서 상당한 양의 작업이 출판되었다.  
더 좁은 범위에서 보면 reconstruction-based anomaly techniques에 대한 연구가 집중되어 왔다. 대부분의 재구성 기반 접근 방식은  
비디오 시퀀스의 이상을 조사하는 데 사용되었다.  
1) Sabokrouet : 겹치지 않는 비디오 패치를 모델링하기 위해 자동 인코더(전역) 및 최근접 유사성(로컬) 기능 설명자 위에 가우시안 분류기의 사용 제안  
2) Medel : 이상 탐지를 위해 CNN+LSTM 사용 / 정상 샘플에 대해서만 훈련된 모델은 추론하는 동안 비정상을 구별하는 가능한 표준 예제의 미래 프레임을 예측  
3) Hasan : 로컬 기능과 FC autoencoder를 사용한 다음 종단 간 특징 추출 및 분류를 위한 Fully-Convolution-Autoencoder를 사용하는 2단계 방식 제안.  
Dimokranitou : 비디오의 이상 탐지에서 적대적 훈련의 효과를 결정하기 위해 AAE 를 사용하여 벤치마크에서 비슷한 성능을 생성  

최근 연구는 adveraial traning 적대적 훈련의 제공에 초점을 맞추었다.  

1) Ravanbakhsh : I2I 변환을 활용하여 혼잡한 장면에서 이상 감지 문제를 검사하고 벤치마크에서 SOTA 달성  
cGAN을 학습시키는 방식으로 첫 번째 G는 프레임에서 광학 흐름을 생성하고 두 번째 G는 광학 흐름에서 프레임을 생성한다.  
위에서 언급한 접근 방식의 일반화 가능성은 많은 경우 데이터 세트에 시간적 특징이 없기 때문에 문제가 된다.  
2) (주요연구)Schlegl : GAN의 latent vector가 데이터의 분포를 나타낸다고 가정한다. 그러나 GAN의 벡터 공간에 매핑하는 것은 간단하지 않다.  
이를 달성하기 위해 일반 이미지만 사용하여 G와 D를 훈련한니다. 다음 단계에서는 가중치를 동결하여 사전 훈련된 생성기와 판별기를 활용하고  
z 벡터를 기반으로 GAN을 최적화하여 잠재 벡터로 다시 매핑한다.  
추론하는 동안 모델은 이전 작업에 비해 상당한 개선을 보고하는 높은 이상 점수를 출력하여 이상을 정확히 찾아낸다.  
이 작업의 주요 제한 사항은 모델이 2단계 접근 방식을 사용하고 잠재 벡터를 다시 매핑하는 데 비용이 매우 많이 들기 때문에 계산 복잡성이다.  
3) Zenati :  이상 감지 작업에서 BiGAN의 사용을 조사하고, 이미지 공간에서 잠재 공간으로 동시에 또는 그 반대로 매핑하기 위한 공동 훈련을 연구  
MNIST 데이터 세트에서 우수한 결과를 얻을 수 있었다.  
  
전반적인 이전 작업은 autoencoder와 GAN의 사용이 이상 탐지 문제에서 가능성을 입증한다는 가설을 강력하게 지지한다.  
[39] 및 [40]에서 연구된 추론을 포함하는 GAN의 아이디어에 동기를 부여하여 G가 인코더 디코더-인코더 하위 네트워크로 구성되고  
이미지와 latent 벡터 공간 모두에서 공동으로 표현을 학습하고 상태를 달성하는 cGAN을 소개한다. 통계 및 계산 모두에서 SOTA를 달성한다.  

## 3 GANomaly

![image](https://user-images.githubusercontent.com/40943064/130704123-6e78b60c-8296-40d6-82f7-865bc5cbae54.png)
